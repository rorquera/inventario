DROP TABLE IF EXISTS DETALLE_VENTAS;
DROP TABLE IF EXISTS CABECERA_VENTAS;
DROP TABLE IF EXISTS HISTORIAL_STOCK;
DROP TABLE IF EXISTS DETALLE_PEDIDO;
DROP TABLE IF EXISTS CABECERA_PEDIDO;
DROP TABLE IF EXISTS ESTADOS_PEDIDO;
DROP TABLE IF EXISTS PROVEEDORES;
DROP TABLE IF EXISTS TIPO_DOCUMENTOS;
DROP TABLE IF EXISTS PRODUCTOS;
DROP TABLE IF EXISTS UNIDADES_MEDIDA;
DROP TABLE IF EXISTS CATEGORIAS_UNIDAD_MEDIDA;
DROP TABLE IF EXISTS CATEGORIAS;

CREATE TABLE CATEGORIAS (
	CODIGO SERIAL NOT NULL,
	NOMBRE VARCHAR(100) NOT NULL,
	CATEGORIA_PADRE INT,
	CONSTRAINT CATEGORIAS_PK PRIMARY KEY (CODIGO),
	CONSTRAINT CATEGORIAS_FK FOREIGN KEY (CATEGORIA_PADRE) REFERENCES CATEGORIAS (CODIGO)
);

INSERT INTO
	PUBLIC.CATEGORIAS (NOMBRE, CATEGORIA_PADRE)
VALUES
	('Materia Prima', NULL);

INSERT INTO
	PUBLIC.CATEGORIAS (NOMBRE, CATEGORIA_PADRE)
VALUES
	('Proteina', 1);

INSERT INTO
	PUBLIC.CATEGORIAS (NOMBRE, CATEGORIA_PADRE)
VALUES
	('Salsas', 1);

INSERT INTO
	PUBLIC.CATEGORIAS (NOMBRE, CATEGORIA_PADRE)
VALUES
	('Punto de Venta', NULL);

INSERT INTO
	PUBLIC.CATEGORIAS (NOMBRE, CATEGORIA_PADRE)
VALUES
	('Bebidas', 4);

INSERT INTO
	PUBLIC.CATEGORIAS (NOMBRE, CATEGORIA_PADRE)
VALUES
	('Con Alcohol', 5);

INSERT INTO
	PUBLIC.CATEGORIAS (NOMBRE, CATEGORIA_PADRE)
VALUES
	('Sin Alcohol', 5);

SELECT
	*
FROM
	CATEGORIAS;

----------------------------
--CATEGORIAS_UNIDAD_MEDIDA--
----------------------------
CREATE TABLE CATEGORIAS_UNIDAD_MEDIDA (
	CODIGO CHAR(1) NOT NULL,
	NOMBRE VARCHAR(50) NOT NULL,
	CONSTRAINT CATEGORIAS_UNIDAD_MEDIDA_PK PRIMARY KEY (CODIGO)
);

INSERT INTO
	PUBLIC.CATEGORIAS_UNIDAD_MEDIDA (CODIGO, NOMBRE)
VALUES
	('U', 'Unidades');

INSERT INTO
	PUBLIC.CATEGORIAS_UNIDAD_MEDIDA (CODIGO, NOMBRE)
VALUES
	('V', 'Volumen');

INSERT INTO
	PUBLIC.CATEGORIAS_UNIDAD_MEDIDA (CODIGO, NOMBRE)
VALUES
	('P', 'Peso');

SELECT
	*
FROM
	CATEGORIAS_UNIDAD_MEDIDA;

-------------------
--UNIDADES_MEDIDA--
-------------------
CREATE TABLE UNIDADES_MEDIDA (
	NOMBRE VARCHAR(3) NOT NULL,
	DESCRIPCION VARCHAR(100) NOT NULL,
	CATEGORIA_UDM CHAR(1) NOT NULL,
	CONSTRAINT UNIDADES_MEDIDA_PK PRIMARY KEY (NOMBRE),
	CONSTRAINT UNIDADES_MEDIDA_CATEGORIAS_UNIDAD_MEDIDA_FK FOREIGN KEY (CATEGORIA_UDM) REFERENCES CATEGORIAS_UNIDAD_MEDIDA (CODIGO)
);

INSERT INTO
	PUBLIC.UNIDADES_MEDIDA (NOMBRE, DESCRIPCION, CATEGORIA_UDM)
VALUES
	('ml', 'mililitros', 'V');

INSERT INTO
	PUBLIC.UNIDADES_MEDIDA (NOMBRE, DESCRIPCION, CATEGORIA_UDM)
VALUES
	('l', 'litros', 'V');

INSERT INTO
	PUBLIC.UNIDADES_MEDIDA (NOMBRE, DESCRIPCION, CATEGORIA_UDM)
VALUES
	('u', 'unidad', 'U');

INSERT INTO
	PUBLIC.UNIDADES_MEDIDA (NOMBRE, DESCRIPCION, CATEGORIA_UDM)
VALUES
	('d', 'docena', 'U');

INSERT INTO
	PUBLIC.UNIDADES_MEDIDA (NOMBRE, DESCRIPCION, CATEGORIA_UDM)
VALUES
	('g', 'gramos', 'P');

INSERT INTO
	PUBLIC.UNIDADES_MEDIDA (NOMBRE, DESCRIPCION, CATEGORIA_UDM)
VALUES
	('kg', 'kilogramos', 'P');

INSERT INTO
	PUBLIC.UNIDADES_MEDIDA (NOMBRE, DESCRIPCION, CATEGORIA_UDM)
VALUES
	('lb', 'libras', 'P');

SELECT
	*
FROM
	UNIDADES_MEDIDA;

-------------
--PRODUCTOS--
-------------
CREATE TABLE PRODUCTOS (
	CODIGO SERIAL NOT NULL,
	NOMBRE VARCHAR(100) NOT NULL,
	UDM VARCHAR(3) NOT NULL,
	PRECIO_VENTA MONEY NOT NULL,
	TIENE_IVA BOOLEAN NOT NULL,
	COSTE MONEY NOT NULL,
	CATEGORIA INT NOT NULL,
	STOCK INT NOT NULL,
	CONSTRAINT PRODUCTOS_PK PRIMARY KEY (CODIGO),
	CONSTRAINT PRODUCTOS_UNIDADES_MEDIDA_UDM_FK FOREIGN KEY (UDM) REFERENCES UNIDADES_MEDIDA (NOMBRE),
	CONSTRAINT PRODUCTOS_UNIDADES_MEDIDA_CATEGORIA_FK FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIAS (CODIGO)
);

INSERT INTO
	PUBLIC.PRODUCTOS (
		NOMBRE,
		UDM,
		PRECIO_VENTA,
		TIENE_IVA,
		COSTE,
		CATEGORIA,
		STOCK
	)
VALUES
	('Coca cola peque√±a', 'u', 0.58, TRUE, 0.39, 7, 105);

INSERT INTO
	PUBLIC.PRODUCTOS (
		NOMBRE,
		UDM,
		PRECIO_VENTA,
		TIENE_IVA,
		COSTE,
		CATEGORIA,
		STOCK
	)
VALUES
	('Salsa de tomate', 'l', 0.95, TRUE, 0.85, 3, 0);

INSERT INTO
	PUBLIC.PRODUCTOS (
		NOMBRE,
		UDM,
		PRECIO_VENTA,
		TIENE_IVA,
		COSTE,
		CATEGORIA,
		STOCK
	)
VALUES
	('Mostaza', 'l', 0.95, TRUE, 0.87, 3, 0);

INSERT INTO
	PUBLIC.PRODUCTOS (
		NOMBRE,
		UDM,
		PRECIO_VENTA,
		TIENE_IVA,
		COSTE,
		CATEGORIA,
		STOCK
	)
VALUES
	('Fuze Tea', 'u', 0.8, TRUE, 0.7, 7, 49);

SELECT
	*
FROM
	PRODUCTOS;

-------------------
--TIPO_DOCUMENTOS--
-------------------
CREATE TABLE TIPO_DOCUMENTOS (
	CODIGO CHAR(1) NOT NULL,
	DESCRIPCION VARCHAR(20) NOT NULL,
	CONSTRAINT TIPO_DOCUMENTOS_PK PRIMARY KEY (CODIGO)
);

INSERT INTO
	PUBLIC.TIPO_DOCUMENTOS (CODIGO, DESCRIPCION)
VALUES
	('C', 'CEDULA');

INSERT INTO
	PUBLIC.TIPO_DOCUMENTOS (CODIGO, DESCRIPCION)
VALUES
	('R', 'RUC');

SELECT
	*
FROM
	TIPO_DOCUMENTOS;

---------------
--PROVEEDORES--
---------------
CREATE TABLE PROVEEDORES (
	IDENTIFICADOR VARCHAR(13) NOT NULL,
	TIPO_DOCUMENTO CHAR(1) NOT NULL,
	NOMBRE VARCHAR(100) NOT NULL,
	TELEFONO VARCHAR(20) NOT NULL,
	CORREO VARCHAR(50) NOT NULL,
	DIRECCION VARCHAR(100) NOT NULL,
	CONSTRAINT PROVEEDORES_PK PRIMARY KEY (IDENTIFICADOR),
	CONSTRAINT PROVEEDORES_TIPO_DOCUMENTOS_PK FOREIGN KEY (TIPO_DOCUMENTO) REFERENCES TIPO_DOCUMENTOS (CODIGO)
);

INSERT INTO
	PUBLIC.PROVEEDORES (
		IDENTIFICADOR,
		TIPO_DOCUMENTO,
		NOMBRE,
		TELEFONO,
		CORREO,
		DIRECCION
	)
VALUES
	(
		'1792285747',
		'C',
		'JUAN PEREZ',
		'0992920306',
		'jperez@gmail.com',
		'Cumbaya'
	);

INSERT INTO
	PUBLIC.PROVEEDORES (
		IDENTIFICADOR,
		TIPO_DOCUMENTO,
		NOMBRE,
		TELEFONO,
		CORREO,
		DIRECCION
	)
VALUES
	(
		'1792285747001',
		'R',
		'SNACKS SA',
		'0992920387',
		'snacks@gmail.com',
		'Quito'
	);

SELECT
	*
FROM
	PROVEEDORES;

------------------
--ESTADOS_PEDIDO--
------------------
CREATE TABLE ESTADOS_PEDIDO (
	CODIGO CHAR(1) NOT NULL,
	DESCRIPCION VARCHAR(30) NOT NULL,
	CONSTRAINT ESTADOS_PEDIDO_PK PRIMARY KEY (CODIGO)
);

INSERT INTO
	PUBLIC.ESTADOS_PEDIDO (CODIGO, DESCRIPCION)
VALUES
	('S', 'Solicitado');

INSERT INTO
	PUBLIC.ESTADOS_PEDIDO (CODIGO, DESCRIPCION)
VALUES
	('R', 'Recibido');

SELECT
	*
FROM
	ESTADOS_PEDIDO;

-------------------
--CABECERA_PEDIDO--
-------------------
CREATE TABLE CABECERA_PEDIDO (
	NUMERO SERIAL NOT NULL,
	PROVEEDOR VARCHAR(13) NOT NULL,
	FECHA DATE NOT NULL,
	ESTADO CHAR(1) NOT NULL,
	CONSTRAINT CABECERA_PEDIDO_PK PRIMARY KEY (NUMERO),
	CONSTRAINT CABECERA_PEDIDO_NUMERO_FK FOREIGN KEY (PROVEEDOR) REFERENCES PROVEEDORES (IDENTIFICADOR),
	CONSTRAINT CABECERA_PEDIDO_ESTADOS_PEDIDO_FK FOREIGN KEY (ESTADO) REFERENCES ESTADOS_PEDIDO (CODIGO)
);

INSERT INTO
	PUBLIC.CABECERA_PEDIDO (PROVEEDOR, FECHA, ESTADO)
VALUES
	('1792285747', '2024-11-20', 'R');

INSERT INTO
	PUBLIC.CABECERA_PEDIDO (PROVEEDOR, FECHA, ESTADO)
VALUES
	('1792285747001', '2024-11-20', 'R');

SELECT
	*
FROM
	CABECERA_PEDIDO;

------------------
--DETALLE_PEDIDO--
------------------
CREATE TABLE DETALLE_PEDIDO (
	CODIGO SERIAL NOT NULL,
	CABECERA_PEDIDO INT NOT NULL,
	PRODUCTO INT NOT NULL,
	CANTIDAD_SOLICITADA INT NOT NULL,
	SUBTOTAL MONEY NOT NULL,
	CANTIDAD_RECIBIDA INT NOT NULL,
	CONSTRAINT DETALLE_PEDIDO_PK PRIMARY KEY (CODIGO),
	CONSTRAINT DETALLE_PEDIDO_CABECERA_PEDIDO_FK FOREIGN KEY (CABECERA_PEDIDO) REFERENCES CABECERA_PEDIDO (NUMERO),
	CONSTRAINT DETALLE_PEDIDO_PRODUCTOS_FK FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTOS (CODIGO)
);

INSERT INTO
	PUBLIC.DETALLE_PEDIDO (
		CABECERA_PEDIDO,
		PRODUCTO,
		CANTIDAD_SOLICITADA,
		SUBTOTAL,
		CANTIDAD_RECIBIDA
	)
VALUES
	(1, 1, 100, 37.9, 100);

INSERT INTO
	PUBLIC.DETALLE_PEDIDO (
		CABECERA_PEDIDO,
		PRODUCTO,
		CANTIDAD_SOLICITADA,
		SUBTOTAL,
		CANTIDAD_RECIBIDA
	)
VALUES
	(1, 4, 50, 11.9, 50);

INSERT INTO
	PUBLIC.DETALLE_PEDIDO (
		CABECERA_PEDIDO,
		PRODUCTO,
		CANTIDAD_SOLICITADA,
		SUBTOTAL,
		CANTIDAD_RECIBIDA
	)
VALUES
	(2, 1, 10, 3.9, 10);

SELECT
	*
FROM
	DETALLE_PEDIDO;

-------------------
--HISTORIAL_STOCK--
-------------------
CREATE TABLE HISTORIAL_STOCK (
	CODIGO SERIAL NOT NULL,
	FECHA TIMESTAMP WITHOUT TIME ZONE NOT NULL,
	REFERENCIA VARCHAR(50) NOT NULL,
	PRODUCTO INT NOT NULL,
	CANTIDAD INT NOT NULL,
	CONSTRAINT HISTORIAL_STOCK_PK PRIMARY KEY (CODIGO),
	CONSTRAINT HISTORIAL_STOCK_PRODUCTOS_FK FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTOS (CODIGO)
);

INSERT INTO
	PUBLIC.HISTORIAL_STOCK (FECHA, REFERENCIA, PRODUCTO, CANTIDAD)
VALUES
	('2024-10-11 19:59', 'PEDIDO 1', 1, 100);

INSERT INTO
	PUBLIC.HISTORIAL_STOCK (FECHA, REFERENCIA, PRODUCTO, CANTIDAD)
VALUES
	('2024-10-11 19:59', 'PEDIDO 1', 4, 50);

INSERT INTO
	PUBLIC.HISTORIAL_STOCK (FECHA, REFERENCIA, PRODUCTO, CANTIDAD)
VALUES
	('2024-10-11 20:00', 'PEDIDO 2', 1, 10);

INSERT INTO
	PUBLIC.HISTORIAL_STOCK (FECHA, REFERENCIA, PRODUCTO, CANTIDAD)
VALUES
	('2024-10-11 20:00', 'VENTA 1', 1, -5);

INSERT INTO
	PUBLIC.HISTORIAL_STOCK (FECHA, REFERENCIA, PRODUCTO, CANTIDAD)
VALUES
	('2024-10-11 20:00', 'VENTA 1', 4, 1);

SELECT
	*
FROM
	HISTORIAL_STOCK;

-------------------
--CABECERA_VENTAS--
-------------------
CREATE TABLE CABECERA_VENTAS (
	CODIGO SERIAL NOT NULL,
	FECHA TIMESTAMP WITHOUT TIME ZONE NOT NULL,
	TOTAL_SIN_IVA MONEY NOT NULL,
	IVA MONEY NOT NULL,
	TOTAL MONEY NOT NULL,
	CONSTRAINT CABECERA_VENTAS_PK PRIMARY KEY (CODIGO)
);

INSERT INTO
	PUBLIC.CABECERA_VENTAS (FECHA, TOTAL_SIN_IVA, IVA, TOTAL)
VALUES
	('2024-11-20 20:00', 3.26, 0.39, 3.65);

SELECT
	*
FROM
	CABECERA_VENTAS;

------------------
--DETALLE_VENTAS--
------------------
CREATE TABLE DETALLE_VENTAS (
	CODIGO SERIAL NOT NULL,
	CABECERA_VENTAS INT NOT NULL,
	PRODUCTO INT NOT NULL,
	CANTIDAD INT NOT NULL,
	PRECIO_VENTA MONEY NOT NULL,
	SUBTOTAL MONEY NOT NULL,
	SUBTOTAL_CON_IVA MONEY NOT NULL,
	CONSTRAINT DETALLE_VENTAS_PK PRIMARY KEY (CODIGO),
	CONSTRAINT DETALLE_VENTAS_CABECERA_VENTAS_FK FOREIGN KEY (CABECERA_VENTAS) REFERENCES CABECERA_VENTAS (CODIGO),
	CONSTRAINT DETALLE_VENTAS_PRODUCTOS_FK FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTOS (CODIGO)
);

INSERT INTO
	PUBLIC.DETALLE_VENTAS (
		CABECERA_VENTAS,
		PRODUCTO,
		CANTIDAD,
		PRECIO_VENTA,
		SUBTOTAL,
		SUBTOTAL_CON_IVA
	)
VALUES
	(1, 1, 5, 0.58, 2.90, 3.25);

INSERT INTO
	PUBLIC.DETALLE_VENTAS (
		CABECERA_VENTAS,
		PRODUCTO,
		CANTIDAD,
		PRECIO_VENTA,
		SUBTOTAL,
		SUBTOTAL_CON_IVA
	)
VALUES
	(1, 4, 1, 0.36, 0.36, 0.40);

SELECT
	*
FROM
	DETALLE_VENTAS;